# Strava Widget

## Warning

This is very much a work in progress and is designed to suit my own needs. As such, it currently does not handle any sports other than running. You're free to modify code if you're a cyclist!

## Description

This module provides a simple widget showing some Strava stats.

Extended info is provided by clicking on the widget.

## Demo

Here are some screenshots from my laptop showing the widget in the bar.

![Screenshot](images/strava_widget.png?raw=true)</br>

![Screenshot](images/strava_widget_detail.png?raw=true)</br>

I've blurred out the details of my runs for privacy reasons.

## Installation

This one is a bit harder to install as it needs two libraries which, if you're running Arch, are not in the AUR. For those users, please install stravalib and units via the .PKGBUILD files included in the repository. You can then install the main PKGBUILD file.

For everyone else, you can clone the repository and run:

```
python setup.py install
```
which, I _believe_, should install the dependencies via pip.

## Strava API

You will need to follow the instuctions at https://developers.strava.com/ to create a new app and authorise it.

Your id and secret should be put in a json file called "auth.json" in ~/.cache/stravawidget

The token file generated by the authorisation process, strava.json, should also be placed in the same folder.

## Configuration

Add the code to your config (`~/.config/qtile/config.py`):

```python
from stravawidget import StravaWidget
...
screens = [
    Screen(
        top=bar.Bar(
            [
                widget.CurrentLayout(),
                widget.GroupBox(),
                widget.Prompt(),
                widget.WindowName(),
                StravaWidget(),
                widget.Clock(format='%Y-%m-%d %a %I:%M %p'),
                widget.QuickExit(),
            ],
            24,
        ),
    ),
]
```

## Customising

The widget allows some basic configuration

The widget can be customised with the following arguments:

<table>
	<tr>
		<td>font</td>
		<td>Default font</td>
	</tr>
	<tr>
		<td>fontsize</td>
		<td>Font size</td>
	</tr>
	<tr>
		<td>font_colour</td>
		<td>Text colour</td>
	</tr>
	<tr>
		<td>text</td>
		<td>Widget text (see below)</td>
	</tr>
	<tr>
		<td>refresh_interval</td>
		<td>Time to update data</td>
	</tr>
	<tr>
		<td>startup_delay</td>
		<td>Time before sending first web request</td>
	</tr>
	<tr>
		<td>popup_display_timeout</td>
		<td>Time to display extended info</td>
	</tr>
</table>

The widget text can be formatted using the following keys:

<table>
    <tr>
    	<td>AA</td>
    	<td>alltime date</td>
    </tr>
    <tr>
    	<td>AC</td>
    	<td>alltime count</td>
    </tr>
    <tr>
    	<td>AD</td>
    	<td>alltime distance</td>
    </tr>
    <tr>
    	<td>AN</td>
    	<td>alltime name</td>
    </tr>
    <tr>
    	<td>AP</td>
    	<td>alltime formatPace</td>
    </tr>
    <tr>
    	<td>AT</td>
    	<td>alltime formatTime</td>
    </tr>
    <tr>
    	<td>CA</td>
    	<td>current date</td>
    </tr>
    <tr>
    	<td>CC</td>
    	<td>current count</td>
    </tr>
    <tr>
    	<td>CD</td>
    	<td>current distance</td>
    </tr>
    <tr>
    	<td>CN</td>
    	<td>current name</td>
    </tr>
    <tr>
    	<td>CP</td>
    	<td>current formatPace</td>
    </tr>
    <tr>
    	<td>CT</td>
    	<td>current formatTime</td>
    </tr>
    <tr>
    	<td>YA</td>
    	<td>year date</td>
    </tr>
    <tr>
    	<td>YC</td>
    	<td>year count</td>
    </tr>
    <tr>
    	<td>YD</td>
    	<td>year distance</td>
    </tr>
    <tr>
    	<td>YN</td>
    	<td>year name</td>
    </tr>
    <tr>
    	<td>YP</td>
    	<td>year formatPace</td>
    </tr>
    <tr>
    	<td>YT</td>
    	<td>year formatTime</td>
    </tr>
</table>

For the above, "current" = current month, "year" = current year and "alltime" is obvious.

For example, setting the default text parameter `{CA:%b} {CD:.1f}km` shows the current month in abbreviated form (CA is a datetime object so can use standard python formatting) and the cumulative distance for the month. This is the format used in the screenshots above.


## Contributing

If you've used this (great, and thank you) you will find bugs so please [file an issue](https://github.com/elParaguayo/qtile-widget-strava/issues/new).
